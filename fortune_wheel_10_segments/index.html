<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Roue de fortune — 10 zones</title>
  <style>
    :root { --size: 560px; }
    * { box-sizing: border-box; }
    html, body { height: 100%; margin: 0; }
    body {
      display: grid; place-items: center;
      background: #0f172a;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color: #e2e8f0;
    }
    .container {
      position: relative;
      width: var(--size); height: var(--size);
      user-select: none; touch-action: manipulation;
    }
    #wheel {
      position: absolute; inset: 0;
      width: 100%; height: 100%;
      transform: rotate(0deg);
      will-change: transform;
      cursor: pointer;
      filter: drop-shadow(0 8px 24px rgba(0,0,0,.35));
    }
    .pointer {
      position: absolute;
      left: 50%; top: -8px;
      width: 0; height: 0;
      transform: translateX(-50%);
      border-left: 14px solid transparent;
      border-right: 14px solid transparent;
      border-bottom: 20px solid #f8fafc;
      filter: drop-shadow(0 2px 6px rgba(0,0,0,.4));
    }
    .hud { margin-top: 14px; text-align: center; opacity: .95; }
    .btns { display: flex; gap: 8px; justify-content: center; margin-top: 8px; flex-wrap: wrap; }
    button {
      background: #334155; color: #e5e7eb; border: 0; border-radius: 10px;
      padding: 8px 12px; font-weight: 600; cursor: pointer;
    }
    button:hover { background: #475569; }
    .hint { font-size: 12px; opacity: .85; margin-top: 6px; }
    .badge {
      margin-top: 10px;
      display: inline-block; padding: 8px 12px; border-radius: 999px;
      background: #10b981; color: #0b1720; font-weight: 700;
    }
    .overlay {
      position: absolute; inset: 0; display: grid; place-items: center;
      pointer-events: none;
    }
    .resultCard {
      display: none;
      background: rgba(15, 23, 42, .92);
      border: 1px solid rgba(148,163,184,.3);
      padding: 14px 16px; border-radius: 12px;
      text-align: center; min-width: 240px;
      filter: drop-shadow(0 8px 24px rgba(0,0,0,.45));
    }
    .resultCard h2 { margin: 0 0 6px 0; font-size: 18px; }
    .resultCard p { margin: 0; opacity: .9; }
    @media (max-width: 600px) { :root { --size: 86vw; } }
  </style>
</head>
<body>
  <main>
    <div class="container" id="stage" aria-label="Roue de fortune, cliquer pour tourner/arrêter">
      <img id="wheel" src="wheel.png" alt="Roue" />
      <div class="pointer" aria-hidden="true"></div>
      <div class="overlay">
        <div class="resultCard" id="resultCard">
          <h2 id="resultTitle">Zone gagnante</h2>
          <p id="resultText"></p>
        </div>
      </div>
    </div>
    <div class="hud">
      <div id="status">Clique pour <strong>tourner</strong>. Clique encore pour <strong>arrêter</strong>.</div>
      <div class="btns">
        <button id="spinBtn">Tourner</button>
        <button id="stopBtn">Arrêter</button>
        <button id="resetBtn">Réinitialiser</button>
      </div>
      <div class="hint">Angle (0° = haut, horaire) : <span id="angleReadout">0</span>° —
        <span class="badge">10 zones</span>
      </div>
    </div>
  </main>

  <script>
    // CONFIG — libellés des 10 zones (tu peux remplacer ces textes)
    const LABELS = [
      "Zone 1","Zone 2","Zone 3","Zone 4","Zone 5",
      "Zone 6","Zone 7","Zone 8","Zone 9","Zone 10"
    ];
    const SEGMENTS = LABELS.length; // = 10

    // Paramètres "physiques"
    const ACCEL           = 0.0018;
    const MAX_SPEED       = 0.030;
    const FRICTION        = 0.00025;
    const MIN_STOP_SPEED  = 0.0006;
    const RANDOM_BONUS    = [800, 2000];

    const wheel   = document.getElementById('wheel');
    const stage   = document.getElementById('stage');
    const spinBtn = document.getElementById('spinBtn');
    const stopBtn = document.getElementById('stopBtn');
    const resetBtn= document.getElementById('resetBtn');
    const status  = document.getElementById('status');
    const angleOut= document.getElementById('angleReadout');
    const resultCard = document.getElementById('resultCard');
    const resultText = document.getElementById('resultText');

    let angle = 0;         // radians
    let speed = 0;         // radians/ms
    let lastT = null;
    let rafId = null;

    let mode = 'idle';     // 'idle' | 'spinning' | 'stopping'
    let stopTimer = 0;
    let stopElapsed = 0;

    function radToDeg(r) {
      let d = (r * 180 / Math.PI) % 360;
      if (d < 0) d += 360;
      return d;
    }
    function updateUI() {
      const deg = radToDeg(angle);
      wheel.style.transform = `rotate(${deg}deg)`;
      angleOut.textContent = Math.round(deg);
      if (mode === 'idle') status.innerHTML = 'Clique pour <strong>tourner</strong>.';
      else if (mode === 'spinning') status.textContent = 'Ça tourne… Clique pour arrêter.';
      else status.textContent = 'Ralentissement…';
    }
    function step(ts) {
      if (lastT == null) lastT = ts;
      const dt = ts - lastT;
      lastT = ts;
      if (mode === 'spinning') {
        speed = Math.min(speed + ACCEL * dt, MAX_SPEED);
      } else if (mode === 'stopping') {
        stopElapsed += dt;
        if (stopElapsed >= stopTimer) {
          speed = Math.max(speed - FRICTION * dt, 0);
          if (speed <= MIN_STOP_SPEED) {
            speed = 0; mode = 'idle'; lastT = null;
            cancelAnimationFrame(rafId); rafId = null;
            // normalise angle 0..360
            angle = angle % (2*Math.PI);
            updateUI();
            showWinner();
            return;
          }
        }
      }
      angle += speed * dt;
      updateUI();
      rafId = requestAnimationFrame(step);
    }
    function goSpin() {
      if (mode !== 'idle') return;
      resultCard.style.display = 'none';
      mode = 'spinning'; stopElapsed = 0; stopTimer = 0;
      speed = Math.max(speed, 0.01); lastT = null;
      if (!rafId) rafId = requestAnimationFrame(step);
      updateUI();
    }
    function goStop() {
      if (mode !== 'spinning') return;
      mode = 'stopping'; stopElapsed = 0;
      const [min, max] = RANDOM_BONUS;
      stopTimer = Math.random() * (max - min) + min;
      updateUI();
    }
    function resetWheel() {
      if (rafId) cancelAnimationFrame(rafId);
      rafId = null; lastT = null;
      angle = 0; speed = 0; mode = 'idle'; stopElapsed = 0; stopTimer = 0;
      resultCard.style.display = 'none';
      updateUI();
    }
    function segmentIndexFromAngle(deg) {
      const size = 360 / SEGMENTS;
      // Décalage pour pointer le centre de segment sous la flèche
      const idx = Math.floor(((deg + size/2) % 360) / size);
      return idx; // 0..SEGMENTS-1
    }
    function showWinner() {
      const deg = Math.round(radToDeg(angle));
      const idx = segmentIndexFromAngle(deg);
      const label = LABELS[idx] || `Segment ${idx+1}`;
      resultText.textContent = `${label} (index ${idx+1}/${SEGMENTS}, angle ${deg}°)`;
      resultCard.style.display = 'block';
    }

    stage.addEventListener('click', () => {
      if (mode === 'idle') goSpin(); else if (mode === 'spinning') goStop();
    });
    spinBtn.addEventListener('click', goSpin);
    stopBtn.addEventListener('click', goStop);
    resetBtn.addEventListener('click', resetWheel);
    updateUI();
  </script>
</body>
</html>
